{"version":3,"file":"frontend.build.DYalwgTj.js","sources":["../src/components/app/frontend-wrapper/index.vue","../src/uixpressFrontend.js"],"sourcesContent":["<script setup>\nimport { ref, onMounted, computed, watchEffect, nextTick } from \"vue\";\nimport { ShadowRoot } from \"vue-shadow-dom\";\n\n// Import comps\nimport Notifications from \"@/components/utility/notifications/index.vue\";\nimport LoadingIndicator from \"@/components/utility/loading-indicator/index.ts\";\nimport AdminMenu from \"@/components/app/menu/index.vue\";\nimport ToolBar from \"@/components/app/toolbar/index.vue\";\n\n// Funcs\nimport { lmnFetch } from \"@/assets/js/functions/lmnFetch.js\";\nimport { watchNodeSize } from \"@/assets/js/functions/watchNodeSize.js\";\nimport { hexToRgb } from \"@/assets/js/functions/hexToRgb.js\";\nimport { isObject } from \"@/assets/js/functions/isObject.js\";\nimport { autoDarkMode } from \"@/assets/js/functions/autoDarkMode.js\";\nimport { mountHelpers } from \"./src/mountHelpers.js\";\nimport { setupColorScheme, useColorScheme } from \"@/assets/js/functions/useColorScheme.js\";\nsetupColorScheme();\nconst { prefersDark } = useColorScheme();\n\n// Refs\nconst adoptedStyleSheets = ref(new CSSStyleSheet());\nconst loading = ref(true);\nconst requiresSetup = ref(false);\nconst bodyholder = ref(null);\nconst shadowRootHolder = ref(null);\n\n// Store\nimport { useAppStore } from \"@/store/app/app.js\";\nconst appStore = useAppStore();\n\n/**\n * Injects styles into shadow root\n */\nconst setStyles = () => {\n  let appStyleNode = document.querySelector(\"#uixpress-frontend-css\");\n\n  const appStyles = appStyleNode.sheet;\n  for (const rule of [...appStyles.cssRules].reverse()) {\n    adoptedStyleSheets.value.insertRule(rule.cssText);\n  }\n  setCustomProperties();\n\n  let temporaryCSS = document.querySelector(\"#uix-temp-style\");\n  if (temporaryCSS) temporaryCSS.remove();\n\n  //appStyleNode.remove();\n};\n\nconst returnCustomCSS = computed(() => {\n  return appStore.state.uixpress_settings?.custom_css || \"\";\n});\n\nconst returnLayout = computed(() => {\n  return appStore.state.uixpress_settings?.layout;\n});\n\nconst setCustomProperties = () => {\n  // Base colors\n  if (Array.isArray(appStore.state.uixpress_settings.base_theme_scale)) {\n    const baseCssValues = appStore.state.uixpress_settings.base_theme_scale;\n    for (let color of baseCssValues) {\n      const hexArray = hexToRgb(color.color);\n      const variableName = `--uix-base-${color.step}`;\n      document.documentElement.style.setProperty(variableName, hexArray.join(\" \"));\n    }\n  }\n\n  // Accent colors\n  if (Array.isArray(appStore.state.uixpress_settings.accent_theme_scale)) {\n    const baseCssValues = appStore.state.uixpress_settings.accent_theme_scale;\n\n    for (let color of baseCssValues) {\n      const hexArray = hexToRgb(color.color);\n      const variableName = `--uix-accent-${color.step}`;\n      document.documentElement.style.setProperty(variableName, hexArray.join(\" \"));\n    }\n  }\n};\n\n/**\n * Get's site settings\n */\nconst getSettings = async () => {\n  // If user can't manage options we need to bail;\n  if (!appStore.state.canManageOptions) return;\n\n  appStore.updateState(\"loading\", true);\n\n  const args = { endpoint: \"wp/v2/settings\", params: {} };\n  const response = await lmnFetch(args);\n\n  // Something went wrong\n  if (!response) {\n    finishLoading();\n    return;\n  }\n  const uixpress_settings = response.data.uixpress_settings;\n\n  if (!uixpress_settings || Array.isArray(uixpress_settings)) {\n    //requiresSetup.value = true;\n    appStore.updateState(\"uixpress_settings\", {});\n    finishLoading();\n    return;\n  }\n\n  appStore.updateState(\"uixpress_settings\", uixpress_settings);\n\n  finishLoading();\n};\n\nconst finishLoading = () => {\n  //appStore.updateState(\"loading\", false);\n  loading.value = false;\n};\n\nconst mountViewTransitions = async () => {\n  // No view transition support\n  if (!document.startViewTransition) return;\n\n  let isNavigating = false;\n\n  window.navigation.addEventListener(\"navigate\", (event) => {\n    const toUrl = new URL(event.destination.url);\n\n    // Only handle navigate events for same-origin navigation\n    if (location.origin !== toUrl.origin) return;\n\n    // Don't intercept if it's a reload or if we're already navigating\n    if (event.navigationType === \"reload\" || event.navigationType === \"replace\" || isNavigating) return;\n\n    // Don't load on hash changes\n    if (toUrl) {\n      if (toUrl.hash) return;\n    }\n\n    appStore.updateState(\"loading\", true);\n\n    setTimeout(() => {\n      appStore.updateState(\"loading\", false);\n    }, 5000);\n  });\n};\n\nwatchEffect(() => {\n  if (prefersDark.value) {\n    document.body.classList.add(\"dark\");\n  } else {\n    document.body.classList.remove(\"dark\");\n  }\n});\n\ndocument.body.classList.add(\"uipc-body\");\n\nsetStyles();\nonMounted(mountViewTransitions);\n\nwindow.addEventListener(\"pagehide\", (event) => {\n  appStore.updateState(\"loading\", false);\n});\n\n// Watch for changes to the settings options and update accordingly\ndocument.addEventListener(\"uipx-settings-update\", (event) => {\n  // Bail if not an object\n  if (!isObject(event.detail)) return;\n  // Update settings\n  appStore.state.uixpress_settings = { ...appStore.state.uixpress_settings, ...event.detail };\n});\n</script>\n\n<template>\n  <ShadowRoot tag=\"div\" :adopted-style-sheets=\"[adoptedStyleSheets]\" :class=\"toolbarContainerClasses\" style=\"font-size: 14px\">\n    <div\n      class=\"bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-700 uipx-normalize absolute left-0 top-0 right-0 text-base text-zinc-700 dark:text-zinc-300\"\n      style=\"z-index: 99999\"\n      :class=\"prefersDark ? 'dark' : ''\"\n    >\n      <component is=\"style\" v-html=\"returnCustomCSS\"></component>\n      <ToolBar :class=\"toolbarClasses\" id=\"uixp-toolbar\" :frontend=\"true\" />\n    </div>\n\n    <component is=\"style\">\n      :host, :root { font-size: 32px; line-height: 1.5; font-family: Arial, sans-serif;} ```css :host .text-xs { font-size: 0.75em; line-height: 1em; } :host .text-sm { font-size: 0.875em;\n      line-height: 1.25em; } :host .text-base { font-size: 1em; line-height: 1.5em; } :host .text-lg { font-size: 1.125em; line-height: 1.75em; } :host .text-xl { font-size: 1.25em; line-height:\n      1.75em; } :host .text-2xl { font-size: 1.5em; line-height: 2em; } :host .text-3xl { font-size: 1.875em; line-height: 2.25em; } ```\n    </component>\n\n    <template v-if=\"Array.isArray(appStore.state.uixpress_settings.external_stylesheets)\" v-for=\"(style, index) in appStore.state.uixpress_settings.external_stylesheets\">\n      <link rel=\"stylesheet\" :id=\"`uix-external-${index}-css`\" :href=\"style\" media=\"all\" />\n    </template>\n  </ShadowRoot>\n</template>\n","import { createApp } from \"vue\";\nimport { createPinia } from \"pinia\";\n\nimport \"./frontend.css\";\n\n// Import store\nimport { useAppStore } from \"@/store/app/app.js\";\nimport { setGlobalProperties } from \"@/setup/setGlobalProperties.js\";\n\n// Import comps\nimport AppWrapper from \"@/components/app/frontend-wrapper/index.vue\";\n\n// Build app\nconst app = createApp(AppWrapper);\n\n// Use pinia\nconst pinia = createPinia();\napp.use(pinia);\n\n// Update app store\nconst appStore = useAppStore();\nsetGlobalProperties(appStore);\n\n// Initialise an empty Map for replacements\nlet replacementMap = new Map();\n\n// Safely create the replacement map if the data is available and valid\nif (appStore && appStore.state && appStore.state.uixpress_settings && Array.isArray(appStore.state.uixpress_settings.text_replacements)) {\n  replacementMap = new Map(\n    appStore.state.uixpress_settings.text_replacements\n      .filter((pair) => Array.isArray(pair) && pair.length === 2 && typeof pair[0] === \"string\" && typeof pair[1] === \"string\")\n      .map((pair) => [pair[0], pair[1]])\n  );\n}\n// Store the original __() function\nconst originalGettext = __;\n\nconst translatorFunction = (text, domain) => {\n  // First, apply our custom replacements\n  let replacedText = replacementMap.get(text) || text;\n  // Then, call the original __() function\n  return originalGettext(replacedText, domain);\n};\n\nwindow.__ = translatorFunction;\n\n// Declare translation functions\napp.config.globalProperties.__ = translatorFunction;\napp.config.globalProperties.sprintf = sprintf;\n\n// Move favicon to head\nconst faviconLink = document.getElementById(\"uipx-favicon\");\n\n// Check if the element exists\nif (faviconLink) {\n  // Get the head element\n  const head = document.getElementsByTagName(\"head\")[0];\n  // Move the favicon link to the head\n  head.appendChild(faviconLink);\n}\n\nconst mountPoint = document.querySelector(\"#wpadminbar\");\nif (mountPoint) {\n  // Create the div element\n  const div = document.createElement(\"div\");\n  div.id = \"uip-classic-app\";\n  mountPoint.appendChild(div);\n  app.mount(div);\n}\n"],"names":["setupColorScheme","prefersDark","useColorScheme","adoptedStyleSheets","ref","appStore","useAppStore","setStyles","appStyles","rule","setCustomProperties","temporaryCSS","returnCustomCSS","computed","_a","baseCssValues","color","hexArray","hexToRgb","variableName","mountViewTransitions","isNavigating","event","toUrl","watchEffect","onMounted","isObject","_createBlock","_unref","ShadowRoot","toolbarContainerClasses","_createElementVNode","_normalizeClass","_resolveDynamicComponent","_createVNode","ToolBar","toolbarClasses","_cache","_createElementBlock","_Fragment","_renderList","style","index","app","createApp","AppWrapper","pinia","createPinia","setGlobalProperties","replacementMap","pair","originalGettext","translatorFunction","text","domain","replacedText","faviconLink","mountPoint","div"],"mappings":"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"}